<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miner Configuration</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Miner Configuration</h1>
        <nav>
            <a href="/">Dashboard</a>
        </nav>
        <form id="config-form">
            <div class="form-group">
                <label for="pool_address">Pool Address</label>
                <input type="text" id="pool_address" name="POOL_ADDRESS">
            </div>
            <div class="form-group">
                <label for="backup_pool_address">Backup Pool Address</label>
                <input type="text" id="backup_pool_address" name="BACKUP_POOL_ADDRESS">
            </div>
            <div class="form-group">
                <label for="wallet_address">Wallet Address</label>
                <input type="text" id="wallet_address" name="WALLET_ADDRESS">
            </div>
            <div class="form-group">
                <label for="worker_name">Worker Name</label>
                <input type="text" id="worker_name" name="WORKER_NAME">
            </div>
            <div class="form-group">
                <label for="gpu_devices">GPU Devices</label>
                <input type="text" id="gpu_devices" name="GPU_DEVICES">
            </div>
            <hr>
            <h2>Overclocking</h2>
            <div class="form-group">
                <label for="apply_oc">Apply Overclocking</label>
                <input type="checkbox" id="apply_oc" name="APPLY_OC">
            </div>
            <div class="form-group">
                <label for="gpu_profile">GPU Profile</label>
                <input type="text" id="gpu_profile" name="GPU_PROFILE">
            </div>
            <div class="form-group">
                <label for="gpu_clock_offset">GPU Clock Offset</label>
                <input type="number" id="gpu_clock_offset" name="GPU_CLOCK_OFFSET">
            </div>
            <div class="form-group">
                <label for="gpu_mem_offset">GPU Memory Offset</label>
                <input type="number" id="gpu_mem_offset" name="GPU_MEM_OFFSET">
            </div>
            <div class="form-group">
                <label for="gpu_power_limit">GPU Power Limit</label>
                <input type="number" id="gpu_power_limit" name="GPU_POWER_LIMIT">
            </div>
            <button type="submit">Save</button>
        </form>
        <button id="restart-miner">Restart Miner</button>
        <div id="status-message"></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch current config and populate the form
            fetch('/api/config')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('pool_address').value = data.POOL_ADDRESS || '';
                    document.getElementById('backup_pool_address').value = data.BACKUP_POOL_ADDRESS || '';
                    document.getElementById('wallet_address').value = data.WALLET_ADDRESS || '';
                    document.getElementById('worker_name').value = data.WORKER_NAME || '';
                    document.getElementById('gpu_devices').value = data.GPU_DEVICES || '';
                    document.getElementById('apply_oc').checked = data.APPLY_OC === 'true';
                    document.getElementById('gpu_profile').value = data.GPU_PROFILE || '';
                    document.getElementById('gpu_clock_offset').value = data.GPU_CLOCK_OFFSET || 0;
                    document.getElementById('gpu_mem_offset').value = data.GPU_MEM_OFFSET || 0;
                    document.getElementById('gpu_power_limit').value = data.GPU_POWER_LIMIT || 0;
                });
            // Handle form submission
            document.getElementById('config-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(this);
                const data = {};
                for (const [key, value] of formData.entries()) {
                    data[key] = value;
                }
                data['APPLY_OC'] = document.getElementById('apply_oc').checked;
                fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => {
                    const statusMessage = document.getElementById('status-message');
                    if (response.ok) {
                        statusMessage.textContent = 'Configuration saved successfully!';
                        statusMessage.className = 'success';
                    } else {
                        statusMessage.textContent = 'Error saving configuration.';
                        statusMessage.className = 'error';
                    }
                });
            });
            // Handle restart button click
            document.getElementById('restart-miner').addEventListener('click', function() {
                fetch('/api/restart', {
                    method: 'POST'
                }).then(response => {
                    const statusMessage = document.getElementById('status-message');
                    if (response.ok) {
                        statusMessage.textContent = 'Miner restarting...';
                        statusMessage.className = 'success';
                    } else {
                        statusMessage.textContent = 'Error restarting miner.';
                        statusMessage.className = 'error';
                    }
                });
            });
        });
    </script>
</body>
</html>
