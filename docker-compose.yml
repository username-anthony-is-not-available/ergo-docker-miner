services:
  nvidia:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - LOLMINER_VERSION=${LOLMINER_VERSION:-1.98a}
    container_name: ergo-miner-nvidia
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - MINER=${MINER:-lolminer}
    ports:
      - "4444:4444"
      - "4455:4455"
      - "4456:4456"
      - "5000:5000"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
  amd:
    build:
      context: .
      dockerfile: Dockerfile.amd
      args:
        - LOLMINER_VERSION=${LOLMINER_VERSION:-1.98a}
    container_name: ergo-miner-amd
    restart: unless-stopped
    env_file:
      - .env
    ports:
      - "4447:4444"
      - "4458:4455"
      - "4459:4456"
      - "5001:5000"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    devices:
      - "/dev/kfd:/dev/kfd"
      - "/dev/dri:/dev/dri"
